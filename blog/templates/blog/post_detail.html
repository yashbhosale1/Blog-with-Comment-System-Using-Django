{% extends 'blog/base.html' %}
{% block content %}
<h2>{{ post.title }}</h2>
<p>{{ post.content }}</p>
<p><small>By {{ post.author.username }} | {{ post.created_at }}</small></p>
<hr>
<h4>Comments</h4>
{% for comment in comments %}
<div class="mb-2">
  <b>{{ comment.user.username }}</b>: {{ comment.content }}
  <form method="post" action="{% url 'add_comment' post.id %}">
    {% csrf_token %}
    <input type="hidden" name="parent_id" value="{{ comment.id }}">
    <input type="text" name="content" placeholder="Reply..." class="form-control mt-1">
  </form>
  {% for reply in comment.replies.all %}
  <div class="ms-4 mt-1"><i>{{ reply.user.username }}</i>: {{ reply.content }}</div>
  {% endfor %}
</div>
{% empty %}
<p>No comments yet.</p>
{% endfor %}
<hr>
<h5>Add a Comment</h5>
<form method="post" action="{% url 'add_comment' post.id %}">
  {% csrf_token %}
  {{ comment_form.as_p }}
  <button type="submit" class="btn btn-primary">Post</button>
</form>
{% endblock %}
